---
title: "toy example"
author: "Michael Seo"
date: "30 Mai 2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Here I tried a toy example: taking only study intercept and treatment effect for only two studies SCQM and BSRBR. Following is the mean estimate + within study covariance matrix


```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
BSRBR_mean <- c(4.731, -0.646, -1.928)
SCQM_mean <- c(3.521, -0.258, -1.601)
BSRBR_Si <- matrix(c(0.00746, -0.00746, -0.00744, -0.00746, 0.012858, 0.00744, -0.007443, 0.007441, 0.020275), ncol = 3)
SCQM_Si <- matrix(c(0.0011667, -0.0011934, -0.00115929, -0.0011934, 0.062375356, 0.000861575, -0.00115929, 0.000861575, 0.1835037), ncol = 3)

BSRBR_Si
SCQM_Si
```

We can look at the correlation matrix of each study

```{r}
cov2cor(BSRBR_Si)
cov2cor(SCQM_Si)
```

Hmm looks like correlation is much higher in BSRBR. This might be because in BSRBR, 1076 patients out of total 2057 were missing DAS28 outcome.

Anyways, we use the formula to pool estimate:

we use equation 4 from this paper https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3470931/

```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
solve(solve(BSRBR_Si) + solve(SCQM_Si)) %*% (solve(BSRBR_Si) %*% BSRBR_mean + solve(SCQM_Si) %*% SCQM_mean)
```

This result seems like what we've been observing.

I think the problem is with the BSRBR. I have removed BSRBR and fit the model and I found that
estimates for (alpha, d[1], d[2]) = (5.13, -0.85, -1.81)